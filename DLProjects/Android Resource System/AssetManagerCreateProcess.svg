<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="827px" style="width:1061px;height:827px;" version="1.1" viewBox="0 0 1061 827" width="1061px"><defs><filter height="300%" id="f7wxmew" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="698.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="58" y="79.1201"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="619.9651" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186" y="147.5061"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="493.1931" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="357" y="242.5237"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="54.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="466" y="626.6992"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="257.2808" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="592" y="305.9097"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="90.386" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="760" y="396.2957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="62.5" x2="62.5" y1="41.1201" y2="786.2256"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="191" x2="191" y1="41.1201" y2="786.2256"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="362" x2="362" y1="41.1201" y2="786.2256"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="471" x2="471" y1="41.1201" y2="786.2256"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="597" x2="597" y1="41.1201" y2="786.2256"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="764.5" x2="764.5" y1="41.1201" y2="786.2256"/><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="17.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="24.5" y="26.0439">ContextImpl</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="17.5" y="785.2256"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="24.5" y="808.2695">ContextImpl</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="146" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="153" y="26.0439">LoadedApk</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="146" y="785.2256"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="153" y="808.2695">LoadedApk</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="308" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="315" y="26.0439">ActivityThread</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="308" y="785.2256"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="315" y="808.2695">ActivityThread</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="428" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="435" y="26.0439">Resources</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="428" y="785.2256"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="435" y="808.2695">Resources</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="524" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="531" y="26.0439">AssetManager_Java</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="524" y="785.2256"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="531" y="808.2695">AssetManager_Java</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="693.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="700.5" y="26.0439">AssetManager_Cpp</text><rect fill="#FEFECE" filter="url(#f7wxmew)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="693.5" y="785.2256"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="700.5" y="808.2695">AssetManager_Cpp</text><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="698.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="58" y="79.1201"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="619.9651" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186" y="147.5061"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="493.1931" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="357" y="242.5237"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="54.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="466" y="626.6992"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="257.2808" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="592" y="305.9097"/><rect fill="#FFFFFF" filter="url(#f7wxmew)" height="90.386" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="760" y="396.2957"/><polygon fill="#A80036" points="46,75.1201,56,79.1201,46,83.1201,50,79.1201" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="52" y1="79.1201" y2="79.1201"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="10" y="75.0181">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="21" y="75.0181">init()</text><polygon fill="#FBFB77" filter="url(#f7wxmew)" points="73,56.1201,73,83.1201,439,83.1201,439,66.1201,429,56.1201,73,56.1201" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429" x2="429" y1="56.1201" y2="66.1201"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="439" x2="429" y1="66.1201" y2="66.1201"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="79" y="76.0181">init的过程会从传入的参数获取到mPackageInfo,mResources</text><polygon fill="#A80036" points="174,143.5061,184,147.5061,174,151.5061,178,147.5061" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68" x2="180" y1="147.5061" y2="147.5061"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="75" y="143.4041">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="86" y="143.4041">getResources()</text><polygon fill="#FBFB77" filter="url(#f7wxmew)" points="201,97.8745,201,178.8745,477,178.8745,477,107.8745,467,97.8745,201,97.8745" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="467" x2="467" y1="97.8745" y2="107.8745"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477" x2="467" y1="107.8745" y2="107.8745"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="207" y="117.7725">getResources在获取Resources的时候</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="207" y="135.5269">首先会去检查本地变量mResources是否存在</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="207" y="153.2813">如果有则直接返回，否则创建</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="207" y="171.0356">这样可以保证resource的单例</text><polygon fill="#A80036" points="345,238.5237,355,242.5237,345,246.5237,349,242.5237" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="196" x2="351" y1="242.5237" y2="242.5237"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="203" y="238.4216">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="214" y="238.4216">getTopLevelResource()</text><polygon fill="#FBFB77" filter="url(#f7wxmew)" points="372,192.8921,372,273.8921,843,273.8921,843,202.8921,833,192.8921,372,192.8921" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="833" x2="833" y1="192.8921" y2="202.8921"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="843" x2="833" y1="202.8921" y2="202.8921"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="378" y="212.79">本地会有一个</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="450" x="378" y="230.5444">HashMap&lt;ResourcesKey, WeakReference&lt;Resources&gt; &gt; mActiveResources</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="378" y="248.2988">用来保存已经创建的资源，ResourcesKey可以等同为资源的路径</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="378" y="266.0532">会优先从这个缓存中进行查找，找不到在进行创建</text><polygon fill="#A80036" points="580,301.9097,590,305.9097,580,309.9097,584,305.9097" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="367" x2="586" y1="305.9097" y2="305.9097"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="374" y="301.8076">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="385" y="301.8076">new()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="602" x2="644" y1="338.4185" y2="338.4185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="644" x2="644" y1="338.4185" y2="351.4185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="603" x2="644" y1="351.4185" y2="351.4185"/><polygon fill="#A80036" points="613,347.4185,603,351.4185,613,355.4185,609,351.4185" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="609" y="333.562">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="620" y="333.562">init()</text><polygon fill="#A80036" points="748,392.2957,758,396.2957,748,400.2957,752,396.2957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="602" x2="754" y1="396.2957" y2="396.2957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="609" y="392.1936">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="620" y="392.1936">addDefaultAssets()</text><polygon fill="#FBFB77" filter="url(#f7wxmew)" points="775,364.4185,775,409.4185,1017,409.4185,1017,374.4185,1007,364.4185,775,364.4185" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1007" x2="1007" y1="364.4185" y2="374.4185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1007" y1="374.4185" y2="374.4185"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="781" y="384.3164">在这里添加的默认路径是系统资源路径</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="781" y="402.0708">/system/framework/framework-res.apk</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="770" x2="812" y1="442.6816" y2="442.6816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="812" x2="812" y1="442.6816" y2="455.6816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="771" x2="812" y1="455.6816" y2="455.6816"/><polygon fill="#A80036" points="781,451.6816,771,455.6816,781,459.6816,777,455.6816" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="777" y="437.8252">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="788" y="437.8252">addAssetPath</text><polygon fill="#A80036" points="613,482.6816,603,486.6816,613,490.6816,609,486.6816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="607" x2="764" y1="486.6816" y2="486.6816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="619" y="482.5796">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="630" y="482.5796">AssetManager_Cpp</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="602" x2="644" y1="519.1904" y2="519.1904"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="644" x2="644" y1="519.1904" y2="532.1904"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="603" x2="644" y1="532.1904" y2="532.1904"/><polygon fill="#A80036" points="613,528.1904,603,532.1904,613,536.1904,609,532.1904" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="609" y="514.334">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="620" y="514.334">ensureSystemAssets()</text><polygon fill="#FBFB77" filter="url(#f7wxmew)" points="765,501.936,765,528.936,1052,528.936,1052,511.936,1042,501.936,765,501.936" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1042" x2="1042" y1="501.936" y2="511.936"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052" x2="1042" y1="511.936" y2="511.936"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="771" y="521.834">创建一个新的AssetManager并且添加资源路径</text><polygon fill="#A80036" points="378,559.1904,368,563.1904,378,567.1904,374,563.1904" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="372" x2="596" y1="563.1904" y2="563.1904"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="384" y="559.0884">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="402" y="559.0884">assets</text><polygon fill="#A80036" points="585,590.9448,595,594.9448,585,598.9448,589,594.9448" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="367" x2="591" y1="594.9448" y2="594.9448"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="374" y="590.8428">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="392" y="590.8428">addAssetPath()</text><polygon fill="#A80036" points="454,622.6992,464,626.6992,454,630.6992,458,626.6992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="367" x2="460" y1="626.6992" y2="626.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="374" y="622.5972">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="392" y="622.5972">new()</text><polygon fill="#A80036" points="378,677.208,368,681.208,378,685.208,374,681.208" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="372" x2="470" y1="681.208" y2="681.208"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="384" y="677.106">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="402" y="677.106">resources</text><polygon fill="#FBFB77" filter="url(#f7wxmew)" points="481,640.4536,481,703.4536,736,703.4536,736,650.4536,726,640.4536,481,640.4536" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726" x2="726" y1="640.4536" y2="650.4536"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="736" x2="726" y1="650.4536" y2="650.4536"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="487" y="660.3516">resources创建完成之后</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="487" y="678.106">通过一段线程安全的代码将其添加到缓存</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="487" y="695.8604">最后再进行返回</text><polygon fill="#A80036" points="207,731.7168,197,735.7168,207,739.7168,203,735.7168" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="201" x2="361" y1="735.7168" y2="735.7168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="213" y="731.6147">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="231" y="731.6147">resources</text><polygon fill="#A80036" points="79,763.4712,69,767.4712,79,771.4712,75,767.4712" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="73" x2="190" y1="767.4712" y2="767.4712"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="85" y="763.3691">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="103" y="763.3691">resources</text></g></svg>