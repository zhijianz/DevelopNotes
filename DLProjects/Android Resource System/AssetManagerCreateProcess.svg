<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="614px" style="width:973px;height:614px;" version="1.1" viewBox="0 0 973 614" width="973px"><defs><filter height="300%" id="fxj4lrt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="485.5791" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="48.5" y="79.1201"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="407.4387" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="165.5" y="147.5061"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="280.6667" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="325.5" y="242.5237"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="54.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="432.5" y="414.1729"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="76.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="558.5" y="305.9097"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="53" x2="53" y1="41.1201" y2="573.6992"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="170.5" x2="170.5" y1="41.1201" y2="573.6992"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="330.5" x2="330.5" y1="41.1201" y2="573.6992"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="437.5" x2="437.5" y1="41.1201" y2="573.6992"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="563.5" x2="563.5" y1="41.1201" y2="573.6992"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="717.5" x2="717.5" y1="41.1201" y2="573.6992"/><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="15" y="26.0439">ContextImpl</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="8" y="572.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="15" y="595.7432">ContextImpl</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="125.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="132.5" y="26.0439">LoadedApk</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="125.5" y="572.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="132.5" y="595.7432">LoadedApk</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="276.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="283.5" y="26.0439">ActivityThread</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="276.5" y="572.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="283.5" y="595.7432">ActivityThread</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="394.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="401.5" y="26.0439">Resources</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="394.5" y="572.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="401.5" y="595.7432">Resources</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="490.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="497.5" y="26.0439">AssetManager_Java</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="490.5" y="572.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="497.5" y="595.7432">AssetManager_Java</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="646.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="653.5" y="26.0439">AssetManager_Cpp</text><rect fill="#FEFECE" filter="url(#fxj4lrt)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="646.5" y="572.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="653.5" y="595.7432">AssetManager_Cpp</text><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="485.5791" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="48.5" y="79.1201"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="407.4387" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="165.5" y="147.5061"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="280.6667" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="325.5" y="242.5237"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="54.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="432.5" y="414.1729"/><rect fill="#FFFFFF" filter="url(#fxj4lrt)" height="76.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="558.5" y="305.9097"/><polygon fill="#A80036" points="36.5,75.1201,46.5,79.1201,36.5,83.1201,40.5,79.1201" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="42.5" y1="79.1201" y2="79.1201"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="10" y="75.0181">init()</text><polygon fill="#FBFB77" filter="url(#fxj4lrt)" points="63,56.1201,63,83.1201,429,83.1201,429,66.1201,419,56.1201,63,56.1201" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="419" y1="56.1201" y2="66.1201"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429" x2="419" y1="66.1201" y2="66.1201"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="69" y="76.0181">init的过程会从传入的参数获取到mPackageInfo,mResources</text><polygon fill="#A80036" points="153.5,143.5061,163.5,147.5061,153.5,151.5061,157.5,147.5061" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="159.5" y1="147.5061" y2="147.5061"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="65.5" y="143.4041">getResources()</text><polygon fill="#FBFB77" filter="url(#fxj4lrt)" points="180,97.8745,180,178.8745,456,178.8745,456,107.8745,446,97.8745,180,97.8745" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="446" x2="446" y1="97.8745" y2="107.8745"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="456" x2="446" y1="107.8745" y2="107.8745"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="186" y="117.7725">getResources在获取Resources的时候</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="186" y="135.5269">首先会去检查本地变量mResources是否存在</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="186" y="153.2813">如果有则直接返回，否则创建</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="186" y="171.0356">这样可以保证resource的单例</text><polygon fill="#A80036" points="313.5,238.5237,323.5,242.5237,313.5,246.5237,317.5,242.5237" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="175.5" x2="319.5" y1="242.5237" y2="242.5237"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="182.5" y="238.4216">getTopLevelResource()</text><polygon fill="#FBFB77" filter="url(#fxj4lrt)" points="340,192.8921,340,273.8921,811,273.8921,811,202.8921,801,192.8921,340,192.8921" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="801" y1="192.8921" y2="202.8921"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="811" x2="801" y1="202.8921" y2="202.8921"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="346" y="212.79">本地会有一个</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="450" x="346" y="230.5444">HashMap&lt;ResourcesKey, WeakReference&lt;Resources&gt; &gt; mActiveResources</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="346" y="248.2988">用来保存已经创建的资源，ResourcesKey可以等同为资源的路径</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="346" y="266.0532">会优先从这个缓存中进行查找，找不到在进行创建</text><polygon fill="#A80036" points="546.5,301.9097,556.5,305.9097,546.5,309.9097,550.5,305.9097" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335.5" x2="552.5" y1="305.9097" y2="305.9097"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="342.5" y="301.8076">new()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="568.5" x2="610.5" y1="338.4185" y2="338.4185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="610.5" x2="610.5" y1="338.4185" y2="351.4185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="569.5" x2="610.5" y1="351.4185" y2="351.4185"/><polygon fill="#A80036" points="579.5,347.4185,569.5,351.4185,579.5,355.4185,575.5,351.4185" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="575.5" y="333.562">addAssetPath()</text><polygon fill="#FBFB77" filter="url(#fxj4lrt)" points="677,321.1641,677,348.1641,964,348.1641,964,331.1641,954,321.1641,677,321.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="954" x2="954" y1="321.1641" y2="331.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="964" x2="954" y1="331.1641" y2="331.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="683" y="341.062">创建一个新的AssetManager并且添加资源路径</text><polygon fill="#A80036" points="346.5,378.4185,336.5,382.4185,346.5,386.4185,342.5,382.4185" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="340.5" x2="562.5" y1="382.4185" y2="382.4185"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="352.5" y="378.3164">assets</text><polygon fill="#A80036" points="420.5,410.1729,430.5,414.1729,420.5,418.1729,424.5,414.1729" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335.5" x2="426.5" y1="414.1729" y2="414.1729"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="342.5" y="410.0708">new()</text><polygon fill="#A80036" points="346.5,464.6816,336.5,468.6816,346.5,472.6816,342.5,468.6816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="340.5" x2="436.5" y1="468.6816" y2="468.6816"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="352.5" y="464.5796">resources</text><polygon fill="#FBFB77" filter="url(#fxj4lrt)" points="447,427.9272,447,490.9272,702,490.9272,702,437.9272,692,427.9272,447,427.9272" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="692" y1="427.9272" y2="437.9272"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="702" x2="692" y1="437.9272" y2="437.9272"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="453" y="447.8252">resources创建完成之后</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="453" y="465.5796">通过一段线程安全的代码将其添加到缓存</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="453" y="483.334">最后再进行返回</text><polygon fill="#A80036" points="186.5,519.1904,176.5,523.1904,186.5,527.1904,182.5,523.1904" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="180.5" x2="329.5" y1="523.1904" y2="523.1904"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="192.5" y="519.0884">resources</text><polygon fill="#A80036" points="69.5,550.9448,59.5,554.9448,69.5,558.9448,65.5,554.9448" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="63.5" x2="169.5" y1="554.9448" y2="554.9448"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="75.5" y="550.8428">resources</text></g></svg>