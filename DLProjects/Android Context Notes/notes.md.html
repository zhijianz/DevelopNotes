<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>notes</title>
      <style>.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(197, 200, 198); overflow: auto; background-color: rgb(29, 31, 33); }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(155, 160, 157); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(155, 160, 157); border-color: rgb(67, 72, 76); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top-width: 2px; border-top-style: dashed; border-top-color: rgb(67, 72, 76); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(67, 72, 76); }
.markdown-preview:not([data-use-github-style]) code { color: rgb(255, 255, 255); background-color: rgb(48, 51, 55); }
.markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(39, 41, 44); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(255, 255, 255); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(67, 72, 76) rgb(67, 72, 76) rgb(53, 57, 60); background-color: rgb(48, 51, 55); }
.markdown-preview[data-use-github-style] { font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); overflow: scroll; background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-style: solid; border-width: 1px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors::shadow .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors::shadow .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover::shadow .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover::shadow .horizontal-scrollbar { visibility: visible; }
.markdown-preview { color: rgba(197, 200, 198, 0.8); background-color: rgb(34, 36, 38); }
.markdown-preview code { color: rgba(197, 200, 198, 0.8); background-color: rgb(39, 41, 44); }
.markdown-preview h1, .markdown-preview h2, .markdown-preview h3 { border-color: rgba(197, 200, 198, 0.0980392); }
.markdown-preview table tr { border-color: rgb(53, 57, 60); background: none; }
.markdown-preview table tr:nth-child(2n) { background-color: rgb(39, 41, 44); }
.markdown-preview table th, .markdown-preview table td { border-color: rgb(53, 57, 60); }
.markdown-preview table th { background-color: rgb(48, 51, 55); }
.markdown-themeable-pdf-page-break {
  border-top: 2px dotted #0098ff;
}
.markdown-themeable-pdf-page-break span {
  opacity: .35;
}

.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

pre.editor-colors,
.host {
  background-color: #1d1f21;
  color: #c5c8c6;
}
pre.editor-colors .invisible-character,
.host .invisible-character {
  color: rgba(197, 200, 198, 0.2);
}
pre.editor-colors .indent-guide,
.host .indent-guide {
  color: rgba(197, 200, 198, 0.2);
}
pre.editor-colors .wrap-guide,
.host .wrap-guide {
  background-color: rgba(197, 200, 198, 0.1);
}
pre.editor-colors .gutter,
.host .gutter {
  background-color: #292c2f;
}
pre.editor-colors .gutter .cursor-line,
.host .gutter .cursor-line {
  background-color: rgba(255, 255, 255, 0.14);
}
pre.editor-colors .line-number.cursor-line-no-selection,
.host .line-number.cursor-line-no-selection {
  background-color: rgba(255, 255, 255, 0.14);
}
pre.editor-colors .gutter .line-number.folded,
.host .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
.host .gutter .line-number:after,
pre.editor-colors .fold-marker:after,
.host .fold-marker:after {
  color: #fba0e3;
}
pre.editor-colors .invisible,
.host .invisible {
  color: #c5c8c6;
}
pre.editor-colors .cursor,
.host .cursor {
  border-color: #ffffff;
}
pre.editor-colors .selection .region,
.host .selection .region {
  background-color: #444444;
}
pre.editor-colors .source.gfm,
.host .source.gfm {
  color: #999;
}
pre.editor-colors .gfm .markup.heading,
.host .gfm .markup.heading {
  color: #eee;
}
pre.editor-colors .gfm .link,
.host .gfm .link {
  color: #555;
}
pre.editor-colors .gfm .variable.list,
.host .gfm .variable.list,
pre.editor-colors .gfm .support.quote,
.host .gfm .support.quote {
  color: #555;
}
pre.editor-colors .gfm .link .entity,
.host .gfm .link .entity {
  color: #ddd;
}
pre.editor-colors .gfm .raw,
.host .gfm .raw {
  color: #aaa;
}
pre.editor-colors .markdown .paragraph,
.host .markdown .paragraph {
  color: #999;
}
pre.editor-colors .markdown .heading,
.host .markdown .heading {
  color: #eee;
}
pre.editor-colors .markdown .raw,
.host .markdown .raw {
  color: #aaa;
}
pre.editor-colors .markdown .link,
.host .markdown .link {
  color: #555;
}
pre.editor-colors .markdown .link .string,
.host .markdown .link .string {
  color: #555;
}
pre.editor-colors .markdown .link .string.title,
.host .markdown .link .string.title {
  color: #ddd;
}
.bracket-matcher .region {
  border-bottom: 1px solid #f8de7e;
  margin-top: -1px;
  opacity: .7;
}
.comment {
  color: #7C7C7C;
}
.entity {
  color: #FFD2A7;
}
.entity.name.type {
  text-decoration: underline;
  color: #FFFFB6;
}
.entity.other.inherited-class {
  color: #9B5C2E;
}
.keyword {
  color: #96CBFE;
}
.keyword.control {
  color: #96CBFE;
}
.keyword.operator {
  color: #EDEDED;
}
.storage {
  color: #CFCB90;
}
.storage.modifier {
  color: #96CBFE;
}
.constant {
  color: #99CC99;
}
.constant.numeric {
  color: #FF73FD;
}
.variable {
  color: #C6C5FE;
}
.invalid.deprecated {
  text-decoration: underline;
  color: #FD5FF1;
}
.invalid.illegal {
  color: #FD5FF1;
  background-color: rgba(86, 45, 86, 0.75);
}
.string .source,
.string .meta.embedded.line {
  color: #EDEDED;
}
.string .punctuation.section.embedded {
  color: #00A0A0;
}
.string .punctuation.section.embedded .source {
  color: #00A0A0;
}
.string {
  color: #A8FF60;
}
.string .constant {
  color: #00A0A0;
}
.string.regexp {
  color: #E9C062;
}
.string.regexp .constant.character.escape,
.string.regexp .source.ruby.embedded,
.string.regexp .string.regexp.arbitrary-repetition {
  color: #FF8000;
}
.string.regexp.group {
  color: #C6A24F;
  background-color: rgba(255, 255, 255, 0.06);
}
.string.regexp.character-class {
  color: #B18A3D;
}
.string .variable {
  color: #8A9A95;
}
.support {
  color: #FFFFB6;
}
.support.function {
  color: #DAD085;
}
.support.constant {
  color: #FFD2A7;
}
.support.type.property-name.css {
  color: #EDEDED;
}
.source .entity.name.tag,
.source .punctuation.tag {
  color: #96CBFE;
}
.source .entity.other.attribute-name {
  color: #C6C5FE;
}
.entity.other.attribute-name {
  color: #C6C5FE;
}
.entity.name.tag.namespace,
.entity.other.attribute-name.namespace {
  color: #E18964;
}
.meta.preprocessor.c {
  color: #8996A8;
}
.meta.preprocessor.c .keyword {
  color: #AFC4DB;
}
.meta.cast {
  color: #676767;
}
.meta.sgml.html .meta.doctype,
.meta.sgml.html .meta.doctype .entity,
.meta.sgml.html .meta.doctype .string,
.meta.xml-processing,
.meta.xml-processing .entity,
.meta.xml-processing .string {
  color: #494949;
}
.meta.tag .entity,
.meta.tag > .punctuation,
.meta.tag.inline .entity {
  color: #C6C5FE;
}
.meta.tag .name,
.meta.tag.inline .name,
.meta.tag > .punctuation {
  color: #96CBFE;
}
.meta.selector.css .entity.name.tag {
  text-decoration: underline;
  color: #96CBFE;
}
.meta.selector.css .entity.other.attribute-name.tag.pseudo-class {
  color: #8F9D6A;
}
.meta.selector.css .entity.other.attribute-name.id {
  color: #8B98AB;
}
.meta.selector.css .entity.other.attribute-name.class {
  color: #62B1FE;
}
.meta.property-group .support.constant.property-value.css,
.meta.property-value .support.constant.property-value.css {
  color: #F9EE98;
}
.meta.preprocessor.at-rule .keyword.control.at-rule {
  color: #8693A5;
}
.meta.property-value .support.constant.named-color.css,
.meta.property-value .constant {
  color: #87C38A;
}
.meta.constructor.argument.css {
  color: #8F9D6A;
}
.meta.diff,
.meta.diff.header {
  color: #F8F8F8;
  background-color: #0E2231;
}
.meta.separator {
  color: #60A633;
  background-color: #242424;
}
.meta.line.entry.logfile,
.meta.line.exit.logfile {
  background-color: rgba(238, 238, 238, 0.16);
}
.meta.line.error.logfile {
  background-color: #751012;
}
</style>
  </head>
  <body class='markdown-preview' data-use-github-style><blockquote>
<p>对于前段时间关于Context学习的汇总，同时也是分享内容的总体大纲</p>
</blockquote>
<h1 id="context">Context</h1>
<p>怎样去定义Context的位置？</p>
<p>贯穿于整个应用的上下文？</p>
<p>或者是提供应用运行时需要的资源，信息等的运行时环境？</p>
<p>又或者是负责启动Activity,Service的场景切换？</p>
<p>对于这些问题的回答和探索只能够通过阅读和理解Context的源代码进行探究和回答。所以，Read The Fucking Source Code!!!</p>
<h1 id="context-">Context 干些什么</h1>
<p>时间和能力上的限制决定了不可能完全的将Context的源代码阅读一遍，只能够通过将其开放出来的接口归纳成为用例图，有目的地去阅读某一部分的代码。</p>
<p><img src="D:\Projects\GitHub\DevelopNotes\DLProjects\Android Context Notes\UML\ContextUsecaseDiagram.svg" alt="Context &#x7528;&#x4F8B;&#x56FE;"></p>
<p>上面的用例图中归纳了Context的常用方式，这种归纳不能做到完备只能说将常见使用枚举出来然后去探究平时在使用这些接口的时候我们本质到上做了什么事情</p>
<h1 id="context-">Context 组成结构</h1>
<p><img src="D:\Projects\GitHub\DevelopNotes\DLProjects\Android Context Notes\UML\ContextClassDiagram.svg" alt="Context &#x76F8;&#x5173;&#x7C7B;&#x56FE;"></p>
<p>我们一直讨论的Context实际上是一个抽象类，只是负责定义Context需要提供的接口而不会做具体的实现；这些具体的实现都交由<code>ContextImpl</code>子类来完成，而我们常常接触到的<code>Activity/Application</code>等实际上都是直接或间接继承自<code>ContextWrapper</code>，其中<code>Activity</code>因为涉及到界面主题之类的内容而直接继承自<code>ContextWrapper</code>的子类<code>ContextThemeWrapper</code>；从类图上可以看到<code>ContextWrapper</code>对<code>ContextImpl</code>有一个依赖，这是因为<code>ContextWrapper</code>实际上也没有自己去实现<code>Context</code>所定义的那些接口而是桥接到一个<code>ContextImpl</code>内部变量来完成这些功能。所以为了弄清楚上面用例图中提及到的接口，我们只需要将重点放在<code>ContextImpl</code>的源代码研究即可。</p>
<h2 id="getresources">getResources</h2>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>Resources</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getResources</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;mResources</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p>从代码中可以看到我们使用<code>Context</code>来获取资源的时候只是简单的将其内容<code>Resources</code>实例变量返回出来，至于这个实例变量的来源是在哪里，我们在讨论<code>Context</code>创建过程的时候再详细学习。</p>
<p>关于<code>Resources</code>从上面的类图中可以大致的看出，这个类抽象了应用程序资源访问的接口从而实现资源的统一管理，虽然在其内部将实际的资源访问操作交给了<code>AssetManager</code>来完成；同时对应应用程序来说，<code>Resources</code>是一个单例的结构。</p>
<h2 id="getassets">getAssets</h2>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>AssetManager</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getAssets</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getResources</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getAssets</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p><code>getAssets()</code>函数通过<code>mResources</code>对象获取到<code>AssetManager</code>对象并返回出来。在介绍<code>Resources</code>的时候将其归结为资源访问的抽象用于提供资源访问的接口，那么<code>AssetManager</code>则是真正的资源管理者，即便是<code>Resources</code>的资源操作接口内部实质也是通过<code>AssetManager</code>实现的。</p>
<h2 id="getpackagemanager">getPackageManager</h2>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>PackageManager</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getPackageManager</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>mPackageManager&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;mPackageManager</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>IPackageManager</span></span><span>&nbsp;pm&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>ActivityThread</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getPackageManager</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>pm&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>&nbsp;Doesn&#39;t&nbsp;matter&nbsp;if&nbsp;we&nbsp;make&nbsp;more&nbsp;than&nbsp;one&nbsp;instance.</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>mPackageManager&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>ApplicationPackageManager</span></span><span class="punctuation bracket round java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;pm</span><span class="punctuation bracket round java"><span>)</span><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p><code>PackageManager</code>本身是一个抽象类，在代码中直接创建的是它的一个子类<code>ApplicationPackageManager</code>。从上面的类图里面可以看到，这个子类提供了获取应用程序各种相关信息的接口，比如四大组件又或者是安装包的信息之类的。所以<code>ContextImpl</code>也可以间接的通过这个成员变量开放出应用程序信息查询的接口。</p>
<h3 id="getapplicationcontext">getApplicationContext</h3>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>Context</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getApplicationContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>mPackageInfo&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="keyword control ternary java"><span>?</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mPackageInfo</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getApplication</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="keyword control ternary java"><span>:</span></span><span>&nbsp;</span><span class="variable other object java"><span>mMainThread</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getApplication</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p><code>getApplicationContext</code>基于两个内部变量进行获取，因为<code>ActivityThread</code>是启动一个应用程序时最先初始化的对象，所以即使<code>mPackageInfo</code>为空的情况下依然可以依赖这个对象去获取<code>ApplicationContext</code></p>
<h3 id="-">小结</h3>
<p>到此为止，关于<code>Context</code>相关的类结构和常用接口源代码分析可以告一段落了，剩下一些在用例图中提及到但是没有进行分析的接口主要是那边的应用场景暂时还没有很深的接触或者是需要其他一些比较重的支持储备，所以只能够暂时搁置，以后再补全吧。</p>
<h1 id="context-">Context 创建流程</h1>
<p>前面的内容介绍了<code>Context</code>的相关类结构以及部分常用源代码的分析，但是关于<code>Context</code>是怎么样创建的并没有提及到，对于里面的一些关键变量的来源和赋值也没有涉及到。所以，接下的部分会详细的研究<code>Context</code>的创建流程，主要的研究对象是<code>Activity/Application</code></p>
<h2 id="applicationcontext-">ApplicationContext 创建过程</h2>
<p><img src="D:\Projects\GitHub\DevelopNotes\DLProjects\Android Context Notes\UML\ApplicationContextCreationSequenceDiagram.svg" alt="ApplicationContext &#x521B;&#x5EFA;&#x8FC7;&#x7A0B;"></p>
<p>上面展示的是<code>ApplicationContext</code>创建过程的代码执行流程图，下面会跟着这个流程图对其中的一些关键部分进行详细的了解</p>
<h3 id="step1-activitythread-main-">Step1:ActivityThread.main()</h3>
<p>每当启动一个新的应用程序的时候都会去创建该程序对应的一个全局<code>Application</code>实例，而这个实例就是我们在这里一直讨论的<code>ApplicationContext</code>。和我们熟悉的<code>Java</code>应用程序一样，<code>Android</code>应用程序同样也有它自己的<code>main函数</code>作为程序的入口，这个<code>main函数</code>位于<code>ActivityThread</code>类中。下面是该函数中的一些关键代码：</p>
<pre class="editor-colors lang-Java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type primitive java"><span>void</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>main</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type object array java"><span>String</span><span class="punctuation bracket square java"><span>[</span><span>]</span></span></span><span>&nbsp;args</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="variable other object java"><span>Looper</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>prepareMainLooper</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="storage type java"><span>ActivityThread</span></span><span>&nbsp;thread&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>ActivityThread</span></span><span class="punctuation bracket round java"><span>(</span><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="variable other object java"><span>thread</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>attach</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="constant language java"><span>false</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>sMainThreadHandler&nbsp;</span><span class="keyword operator comparison java"><span>==</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sMainThreadHandler&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>thread</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getHandler</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="variable other object java"><span>Looper</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>loop</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>RuntimeException</span></span><span class="punctuation bracket round java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>Main&nbsp;thread&nbsp;loop&nbsp;unexpectedly&nbsp;exited</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p>在上面的代码中主要做了两件事情，一个是启动主线程的消息循环；另一个则是创建并初始化应用程序的主线程<code>ActivityThread</code>，而我们所关心的<code>ApplicationContext</code>就是在这里面发生的。</p>
<h3 id="setp3-activitythread-attach-">Setp3:ActivityThread.attach()</h3>
<p>应为在<code>ActivityThread</code>中并没有去做什么和<code>Context</code>相关的内容，所以我们在这里就直接跳到step3</p>
<pre class="editor-colors lang-Java"><div class="line"><span class="source java"><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span class="storage type java"><span>Instrumentation</span></span><span>&nbsp;mInstrumentation</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="storage type java"><span>Application</span></span><span>&nbsp;mInitialApplication</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage type primitive java"><span>void</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>attach</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type primitive java"><span>boolean</span></span><span>&nbsp;system</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>try</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mInstrumentation&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Instrumentation</span></span><span class="punctuation bracket round java"><span>(</span><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>ContextImpl</span></span><span>&nbsp;context&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>ContextImpl</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>createAppContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getSystemContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>mPackageInfo</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mInitialApplication&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>context</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>mPackageInfo</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>makeApplication</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="constant language java"><span>true</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mInitialApplication</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>onCreate</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>catch</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>Exception</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>RuntimeException</span></span><span class="punctuation bracket round java"><span>(</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>Unable&nbsp;to&nbsp;instantiate&nbsp;Application():</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;</span><span class="variable other object java"><span>e</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>toString</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p><code>attach()</code>的作用主要是用来初始化<code>ActivityThread</code>对象实例，在这个初始化的过程中创建了两个实例变量分别是<code>mInstrumentation</code>和<code>mInitialApplication</code>，<code>mInstrumentation</code>主要用来监听系统和应用程序之间的交互而<code>mInitialApplication</code>则就是我们所等待的<code>ApplicationContext</code>。在此之前我们提及过<code>ApplicationContext</code>继承自<code>ContextWrapper</code>，所以在其内部会有一个<code>ContextImpl</code>对象用来完成<code>Context</code>需要完成的内容。从这段代码中我们也理所当然的看到了<code>ContextImpl</code>的创建。</p>
<h3 id="step6-contextimpl-createappcontext-">Step6:ContextImpl.createAppContext()</h3>
<pre class="editor-colors lang-Java"><div class="line"><span class="source java"><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type java"><span>ContextImpl</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>createAppContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>ActivityThread</span></span><span>&nbsp;mainThread</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>LoadedApk</span></span><span>&nbsp;packageInfo</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>packageInfo&nbsp;</span><span class="keyword operator comparison java"><span>==</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>IllegalArgumentException</span></span><span class="punctuation bracket round java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>packageInfo</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>ContextImpl</span></span><span class="punctuation bracket round java"><span>(</span></span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;mainThread</span><span class="punctuation separator delimiter java"><span>,</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;packageInfo</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>false</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>Display</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>INVALID_DISPLAY</span></span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p>这个函数中简单的调用了构建函数来创建一个<code>ContextImpl</code>实例，具体的实现过程和传入的参数内容在这里先不做深入的研究。</p>
<h3 id="step8-loadedapk-makeapplication-">Step8:LoadedApk.makeApplication()</h3>
<pre class="editor-colors lang-Java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>Application</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>makeApplication</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type primitive java"><span>boolean</span></span><span>&nbsp;forceDefaultAppClass</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta function-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Instrumentation</span></span><span>&nbsp;instrumentation</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>mApplication&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;mApplication</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Application</span></span><span>&nbsp;app&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;appClass&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>mApplicationInfo</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>className</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>forceDefaultAppClass&nbsp;</span><span class="keyword operator logical java"><span>||</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>appClass&nbsp;</span><span class="keyword operator comparison java"><span>==</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;appClass&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android.app.Application</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>try</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>java</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>lang</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>ClassLoader</span></span><span>&nbsp;cl&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getClassLoader</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="keyword operator logical java"><span>!</span></span><span class="variable other object java"><span>mPackageName</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>equals</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>initializeJavaContextClassLoader</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>ContextImpl</span></span><span>&nbsp;appContext&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>ContextImpl</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>createAppContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>mActivityThread</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>mActivityThread</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>mInstrumentation</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>newApplication</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cl</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;appClass</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;appContext</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>appContext</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setOuterContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>app</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>catch</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>Exception</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="keyword operator logical java"><span>!</span></span><span class="variable other object java"><span>mActivityThread</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>mInstrumentation</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>onException</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>app</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;e</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>RuntimeException</span></span><span class="punctuation bracket round java"><span>(</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>Unable&nbsp;to&nbsp;instantiate&nbsp;application&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;appClass</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>:&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;</span><span class="variable other object java"><span>e</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>toString</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mActivityThread</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>mAllApplications</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>add</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>app</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mApplication&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;app</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;app</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p>在调用<code>LoadedApk.makeApplication()</code>创建<code>Application</code>的时候首先回去检查<code>mApplication</code>这个本地变量是否存在，如果这个变量已经存在就会直接返回，否在在通过调用<code>Instrumentation.newApplication()</code>函数进行创建。在创建的过程中，对先去调用<code>ContextImpl.createAppContext()</code>为这个<code>Application</code>生成实现其功能的<code>ContextImpl</code>；这个函数的执行流程在上面已经具体的了解过，在其内部会调用<code>ContextImpl</code>的构造函数进行实例的创建。</p>
<h3 id="step11-instrumentation-newapplication-">Step11:Instrumentation.newApplication()</h3>
<pre class="editor-colors lang-Java"><div class="line"><span class="source java"><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>Application</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>newApplication</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>Class</span></span><span class="punctuation bracket angle java"><span>&lt;</span></span><span class="storage type generic wildcard java"><span>?</span></span><span class="punctuation bracket angle java"><span>&gt;</span></span><span>&nbsp;clazz</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Context</span></span><span>&nbsp;context</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;</span><span class="storage type java"><span>InstantiationException</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>IllegalAccessException</span></span><span class="punctuation separator delimiter java"><span>,</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>ClassNotFoundException</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Application</span></span><span>&nbsp;app&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>Application</span></span><span class="punctuation bracket round java"><span>)</span></span><span class="variable other object java"><span>clazz</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>newInstance</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>app</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>attach</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>context</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;app</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p><code>Instrumentation.newApplication()</code>会调用<code>Application</code>的无参构造函数创建一个实例，随后在去调用<code>Application.attach()</code>方法对实例进行初始化操作。</p>
<h3 id="step14-application-attach-">Step14:Application.attach()</h3>
<pre class="editor-colors lang-Java"><div class="line"><span class="source java"><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type primitive java"><span>void</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>attach</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>Context</span></span><span>&nbsp;context</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>attachBaseContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>context</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mLoadedApk&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>ContextImpl</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getImpl</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>context</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>mPackageInfo</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p><code>Application.attach()</code>调用<code>Application.attachBaseContext()</code>将当前传入的<code>ContextImpl</code>实例赋值给<code>mBase</code>实例变量，至此，用于实现<code>Context</code>功能的实例变量已经有了；之后还会对<code>mLoadedApk</code>变量进行复制，然后整个<code>Application</code>的创建过程就算是完成了。</p>
<h2 id="activitycontext-">ActivityContext 创建过程</h2>
<p><img src="D:\Projects\GitHub\DevelopNotes\DLProjects\Android Context Notes\UML\ActivityContextCreationSequenceDiagram.svg" alt="ActivityContext &#x521B;&#x5EFA;&#x6D41;&#x7A0B;&#x56FE;"></p>
<h3 id="step1-activitythread-performlaunchactivity-">Step1: ActivityThread.performLaunchActivity()</h3>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage type java"><span>Activity</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>performLaunchActivity</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>ActivityClientRecord</span></span><span>&nbsp;r</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Intent</span></span><span>&nbsp;customIntent</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Activity</span></span><span>&nbsp;activity&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>try</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>java</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>lang</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>ClassLoader</span></span><span>&nbsp;cl&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>packageInfo</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getClassLoader</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;activity&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>mInstrumentation</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>newActivity</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cl</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>component</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getClassName</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>intent</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>catch</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>Exception</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="keyword operator logical java"><span>!</span></span><span class="variable other object java"><span>mInstrumentation</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>onException</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>activity</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;e</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>RuntimeException</span></span><span class="punctuation bracket round java"><span>(</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>Unable&nbsp;to&nbsp;instantiate&nbsp;activity&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;component</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>:&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;</span><span class="variable other object java"><span>e</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>toString</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>try</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Application</span></span><span>&nbsp;app&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>packageInfo</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>makeApplication</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="constant language java"><span>false</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;mInstrumentation</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>activity&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Context</span></span><span>&nbsp;appContext&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>createBaseContextForActivity</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>r</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;activity</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>CharSequence</span></span><span>&nbsp;title&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>activityInfo</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>loadLabel</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable other object java"><span>appContext</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getPackageManager</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Configuration</span></span><span>&nbsp;config&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Configuration</span></span><span class="punctuation bracket round java"><span>(</span></span><span>mCompatConfiguration</span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>activity</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>attach</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>appContext</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>getInstrumentation</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>token</span></span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>ident</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;app</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>intent</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>activityInfo</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;title</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>parent</span></span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>embeddedID</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>lastNonConfigurationInstances</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;config</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>referrer</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>voiceInteractor</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type primitive java"><span>int</span></span><span>&nbsp;theme&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>activityInfo</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getThemeResource</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>theme&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant numeric java"><span>0</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>activity</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setTheme</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>theme</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>调用Activity生命周期函数</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>paused</span></span><span>&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="constant language java"><span>true</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mActivities</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>put</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>token</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;r</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>catch</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>SuperNotCalledException</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;e</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>catch</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>Exception</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="keyword operator logical java"><span>!</span></span><span class="variable other object java"><span>mInstrumentation</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>onException</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>activity</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;e</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>RuntimeException</span></span><span class="punctuation bracket round java"><span>(</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>Unable&nbsp;to&nbsp;start&nbsp;activity&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;component</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>:&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;</span><span class="variable other object java"><span>e</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>toString</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;activity</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p>在<code>Application</code>创建完成之后，<code>AMS</code>会通过<code>Binder</code>机制通知<code>ActivityThread</code>去创建<code>Activity</code>，而这个创建的过程最终辗转到了<code>performLaunchActivity</code>。上面的代码是该函数精简后的关键代码，省略了一些和<code>Context</code>无关的内容。在这个函数中，完成了<code>Activity</code>的创建、属性初始化和生命周期调用。下面会逐步分析整个创建的过程。</p>
<h3 id="instrumentation-newactivity">Instrumentation.newActivity</h3>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>Activity</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>newActivity</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>ClassLoader</span></span><span>&nbsp;cl</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;className</span><span class="punctuation separator delimiter java"><span>,</span></span><span class="storage type java"><span>Intent</span></span><span>&nbsp;intent</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span></span></div><div class="line"><span class="source java"><span>throws&nbsp;</span><span class="storage type java"><span>InstantiationException</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>IllegalAccessException</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span class="storage type java"><span>ClassNotFoundException</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>Activity</span></span><span class="punctuation bracket round java"><span>)</span></span><span class="variable other object java"><span>cl</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>loadClass</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>className</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>newInstance</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p><code>ActivityThread</code>首先会调用<code>Instrumentation.newActivity()</code>来创建一个<code>Activity</code>实例。从上面的代码中可以知道，这个函数会通过出入的<code>ClassLoader</code>加载<code>Activity</code>并调用其无参构造函数创建实例。</p>
<h3 id="loadedapk-makeapplication">LoadedApk.makeApplication</h3>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>&nbsp;略，参上</span><span>&nbsp;</span></span></span></div></pre>
<p>在<code>Activity</code>实例创建完成之后会继续为该实例对象准备其初始化需要的数据，首先就是调用<code>LoadedApk.makeApplication()</code>为其获取当前应用程序的<code>Application</code>对象。其实这个函数在之前我们学习<code>ApplicationContext</code>创建过程的时候已经了解过其中的运行的源代码，所以这里就不会再深入的进行探讨，只需知道这个函数会返回一个单例<code>Application</code>对象即可。</p>
<h3 id="activitythread-createbasecontextforactivity-contextimpl-createactivitycontext">ActivityThread.createBaseContextForActivity &amp; ContextImpl.createActivityContext</h3>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage type java"><span>Context</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>createBaseContextForActivity</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>ActivityClientRecord</span></span><span>&nbsp;r</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>Activity</span></span><span>&nbsp;activity</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type primitive java"><span>int</span></span><span>&nbsp;displayId&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>Display</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>DEFAULT_DISPLAY</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control catch-exception java"><span>try</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;displayId&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>ActivityManagerNative</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getDefault</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getActivityDisplayId</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>token</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>catch</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>RemoteException</span></span><span>&nbsp;e</span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>ContextImpl</span></span><span>&nbsp;appContext&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>ContextImpl</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>createActivityContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>packageInfo</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;displayId</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>r</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>overrideConfig</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>appContext</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setOuterContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>activity</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Context</span></span><span>&nbsp;baseContext&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;appContext</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;</span><span class="punctuation separator period java"><span>.</span><span>.</span><span>.</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;baseContext</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type java"><span>ContextImpl</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>createActivityContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>ActivityThread</span></span><span>&nbsp;mainThread</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta function-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>LoadedApk</span></span><span>&nbsp;packageInfo</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type primitive java"><span>int</span></span><span>&nbsp;displayId</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Configuration</span></span><span>&nbsp;overrideConfiguration</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>packageInfo&nbsp;</span><span class="keyword operator comparison java"><span>==</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="keyword control catch-exception java"><span>throw</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>IllegalArgumentException</span></span><span class="punctuation bracket round java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>packageInfo</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>ContextImpl</span></span><span class="punctuation bracket round java"><span>(</span></span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;mainThread</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;packageInfo</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="constant language java"><span>false</span></span><span class="punctuation separator delimiter java"><span>,</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;overrideConfiguration</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;displayId</span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p>在获取到该应用的<code>Application</code>实例对象之后，仍然会继续创建其他用于初始化该<code>Activity</code>对象的参数，其中就包括其自身的<code>ContextImpl</code>。在为<code>Activity</code>实例创建过<code>ContextImpl</code>时候，首先会去调用<code>ActivityThread.createBaseContextForActivity</code>和<code>ContextImpl.createActivityContext</code>根据传入的参数为该对象创建<code>ContextImpl</code></p>
<h3 id="activity-attach">Activity.attach</h3>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type primitive java"><span>void</span></span><span>&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>attach</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="storage type java"><span>Context</span></span><span>&nbsp;context</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>ActivityThread</span></span><span>&nbsp;aThread</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta function-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Instrumentation</span></span><span>&nbsp;instr</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>IBinder</span></span><span>&nbsp;token</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type primitive java"><span>int</span></span><span>&nbsp;ident</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta function-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Application</span></span><span>&nbsp;application</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Intent</span></span><span>&nbsp;intent</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>ActivityInfo</span></span><span>&nbsp;info</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta function-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>CharSequence</span></span><span>&nbsp;title</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Activity</span></span><span>&nbsp;parent</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;id</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta function-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>NonConfigurationInstances</span></span><span>&nbsp;lastNonConfigurationInstances</span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta function-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Configuration</span></span><span>&nbsp;config</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;referrer</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>IVoiceInteractor</span></span><span>&nbsp;voiceInteractor</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call java"><span class="entity name function java"><span>attachBaseContext</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span>context</span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mFragments</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>attachHost</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="constant language java"><span>null</span></span><span>&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>parent</span><span class="punctuation definition comment java"><span>*/</span></span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mWindow&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>PhoneWindow</span></span><span class="punctuation bracket round java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setCallback</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setOnWindowDismissedCallback</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getLayoutInflater</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setPrivateFactory</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="variable other object java"><span>info</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>softInputMode</span></span><span>&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="variable other object java"><span>WindowManager</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other object property java"><span>LayoutParams</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>SOFT_INPUT_STATE_UNSPECIFIED</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setSoftInputMode</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable other object java"><span>info</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>softInputMode</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="variable other object java"><span>info</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>uiOptions</span></span><span>&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant numeric java"><span>0</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setUiOptions</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable other object java"><span>info</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>uiOptions</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mUiThread&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>Thread</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>currentThread</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mMainThread&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;aThread</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mInstrumentation&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;instr</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mToken&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;token</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mIdent&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;ident</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mApplication&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;application</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mIntent&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;intent</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mReferrer&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;referrer</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mComponent&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>intent</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getComponent</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mActivityInfo&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;info</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mTitle&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;title</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mParent&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;parent</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mEmbeddedID&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;id</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mLastNonConfigurationInstances&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;lastNonConfigurationInstances</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>voiceInteractor&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>lastNonConfigurationInstances&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mVoiceInteractor&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>lastNonConfigurationInstances</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>voiceInteractor</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span><span>&nbsp;</span><span class="keyword control java"><span>else</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mVoiceInteractor&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>VoiceInteractor</span></span><span class="punctuation bracket round java"><span>(</span></span><span>voiceInteractor</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="punctuation separator delimiter java"><span>,</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>Looper</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>myLooper</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation bracket round java"><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setWindowManager</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="storage type java"><span>WindowManager</span></span><span class="punctuation bracket round java"><span>)</span></span><span class="variable other object java"><span>context</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getSystemService</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable other object java"><span>Context</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>WINDOW_SERVICE</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mToken</span><span class="punctuation separator delimiter java"><span>,</span></span><span>&nbsp;</span><span class="variable other object java"><span>mComponent</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>flattenToString</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation separator delimiter java"><span>,</span></span></span></span></div><div class="line"><span class="source java"><span class="meta method-call java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span class="variable other object java"><span>info</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>flags</span></span><span>&nbsp;</span><span class="keyword operator bitwise java"><span>&amp;</span></span><span>&nbsp;</span><span class="variable other object java"><span>ActivityInfo</span></span><span class="punctuation separator period java"><span>.</span></span><span class="variable other property java"><span>FLAG_HARDWARE_ACCELERATED</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant numeric java"><span>0</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span class="punctuation bracket round java"><span>(</span></span><span>mParent&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span class="punctuation bracket round java"><span>)</span></span><span>&nbsp;</span><span class="punctuation section block begin bracket curly java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>setContainer</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="variable other object java"><span>mParent</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getWindow</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mWindowManager&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="variable other object java"><span>mWindow</span></span><span class="meta method-call java"><span class="punctuation separator period java"><span>.</span></span><span class="entity name function java"><span>getWindowManager</span></span><span class="punctuation definition parameters begin bracket round java"><span>(</span></span><span class="punctuation definition parameters end bracket round java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;mCurrentConfig&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;config</span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span class="punctuation section block end bracket curly java"><span>}</span></span></span></div></pre>
<p>最后，在所有的参数都创建完毕之后，直接调用<code>Activity.attach()</code>函数进行初始化操作。而在这个函数里面，我们关心的只有调用了<code>attachBaseContext</code>将传入的之前为其创建的<code>ContextImpl</code>实例用于完成<code>Context</code>的职责。至此，<code>Activity</code>创建流程中关于<code>Context</code>的内容就已经分析完了。</p>
<h3 id="-">小结</h3>
<p>整个<code>ActivityContext</code>创建流程分析下来，其实基本上就是可以归结成这样一个步骤</p>
<p>&quot;创建Activity实例&quot; --&gt; &quot;构建Activity初始化参数，主要是ContextImpl&quot; --&gt; &quot;进行初始化操作&quot;</p>
<p>在这个流程中<code>Instrumentation/ContextImpl</code>两个类都起到了很大的作用，一个是创建了<code>Activity</code>实例对象，另一个为该对象生成对应的<code>ContextImpl</code>变量。</p>
<h1 id="context-">Context 是什么</h1>
<p>没错，虽然洋洋洒洒写了这么多东西，但是我还是没有办法很明确的说<code>Context</code>到底是一个什么东西。只能从涉及到的代码给它下这样子的一个定义，抽象应用程序逻辑之外的资源或信息相关的接口</p></body>
</html>
